
<!DOCTYPE html>
<html>
<head>
  <title>International collaboration in OpenStreetMap</title>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.3/leaflet.css" />
  <link href='http://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'>

  <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.3/leaflet.ie.css" />
  <![endif]-->

  <style>

    body {
            width: 1280px;

      font-family: 'Cabin', sans-serif;
    }

    #map {
      width: 1280px;
      height: 800px;
      background-color: #daeef4;
    }

    .info {
      padding: 6px 8px;
      font-family: 'Cabin', sans-serif;
      background: white;
      background: rgba(255,255,255,0.8);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }

    .legend {
      text-align: left;
      line-height: 18px;
      color: #555;
    }
    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>Mapping international cooperation in <a href="http://www.openstreetmap.org">OpenStreetMap</a></h1>
  <div id="map"></div>
  <br />All nodes in the OSM Planet from the 15th June 2013 have been analyzed. For each contributors, the nodes they have contributed in every countries have been counted. Each contributor has been assigned a main country of contribution. All this data has then been merged together to know, for each country, where people mainly contributing in this country have been mapping elsewhere.

  <script src="http://cdn.leafletjs.com/leaflet-0.6.3/leaflet.js"></script>
  <script type="text/javascript" src="worldcountries.geojson"></script>
  <script type="text/javascript" src="connections.js"></script>
  <script type="text/javascript">

    var osmAttrib='Data from <a href="http://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, countries from <a href="http://www.naturalearthdata.com/">Natural Earth</a>, analyzed by <a href="mailto:fredericbonifas@gmail.com">Frédéric Bonifas</a> at <a href="http://www.makina-corpus.com">Makina Corpus</a>';

    var map = L.map('map').setView([0, 0], 2);
    // Don't show the 'Powered by Leaflet' text 
    map.attributionControl.setPrefix(osmAttrib);

    var countriesStyle = {
      color: "grey",
      weight: 1,
      opacity: 1,
      fillColor: "white",
      fillOpacity: 1
    };


    function getColor(d) {
    return d > 1000000 ? '#BD0026' :
           d > 100000  ? '#F03B20' :
           d > 10000   ? '#FD8D3C' :
           d > 1000    ? '#FEB24C' :
           d > 100     ? '#FED976' :
                         '#FFFFB2';
}


    function highlightFeature(e) {
      var layer = e.target;
      layer.setStyle({
        color: 'grey',
        weight: 3,
        fillColor: "lightgrey",
        fillOpacity: 1
      });
      for(i=1;i<242 ;i++){ 
        if(connections[layer.feature.properties.gid][i] != undefined) {
          changeColor(i,connections[layer.feature.properties.gid][i]);
        }
      }
    }

    function changeColor(e,f) {
      var newid=e+100000;
      map._layers[newid].setStyle({color: "grey",fillColor: getColor(f), weight: 0.5});
    }

    var geojson;

    function resetHighlight(e) {
      geojson.setStyle(countriesStyle);
    }

    function onEachFeature(feature, layer) {
      layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
      });
      layer._leaflet_id = feature.properties.gid+100000;
    }

    geojson = L.geoJson(countries, {
      style: countriesStyle,
      onEachFeature: onEachFeature
    }).addTo(map);

    var legend = L.control({position: 'bottomright'});

    legend.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend'),
            grades = [1, 100, 1000, 10000, 100000, 1000000],
            labels = [];

        // loop through our density intervals and generate a label with a colored square for each interval
        div.innerHTML += 'Nodes contributed in other <br />countries by people mainly <br />mapping in the selected country<br />';
        for (var i = 0; i < grades.length; i++) {
            div.innerHTML +=
                '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
                grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
        }

        return div;
    };

    legend.addTo(map);


  </script>
</body>
</html>
